* vary
:PROPERTIES:
:CUSTOM_ID: vary
:END:
[[https://npmjs.org/package/vary][[[https://img.shields.io/npm/v/vary.svg]]]]
[[https://npmjs.org/package/vary][[[https://img.shields.io/npm/dm/vary.svg]]]]
[[https://nodejs.org/en/download][[[https://img.shields.io/node/v/vary.svg]]]]
[[https://travis-ci.org/jshttp/vary][[[https://img.shields.io/travis/jshttp/vary/master.svg]]]]
[[https://coveralls.io/r/jshttp/vary][[[https://img.shields.io/coveralls/jshttp/vary/master.svg]]]]

Manipulate the HTTP Vary header

** Installation
:PROPERTIES:
:CUSTOM_ID: installation
:END:
This is a [[https://nodejs.org/en/][Node.js]] module available through
the [[https://www.npmjs.com/][npm registry]]. Installation is done using
the
[[https://docs.npmjs.com/getting-started/installing-npm-packages-locally][=npm install=
command]]:

#+begin_src sh
$ npm install vary
#+end_src

** API
:PROPERTIES:
:CUSTOM_ID: api
:END:

#+begin_html
  <!-- eslint-disable no-unused-vars -->
#+end_html

#+begin_src js
var vary = require('vary')
#+end_src

*** vary(res, field)
:PROPERTIES:
:CUSTOM_ID: varyres-field
:END:
Adds the given header =field= to the =Vary= response header of =res=.
This can be a string of a single field, a string of a valid =Vary=
header, or an array of multiple fields.

This will append the header if not already listed, otherwise leaves it
listed in the current location.

#+begin_html
  <!-- eslint-disable no-undef -->
#+end_html

#+begin_src js
// Append "Origin" to the Vary header of the response
vary(res, 'Origin')
#+end_src

*** vary.append(header, field)
:PROPERTIES:
:CUSTOM_ID: vary.appendheader-field
:END:
Adds the given header =field= to the =Vary= response header string
=header=. This can be a string of a single field, a string of a valid
=Vary= header, or an array of multiple fields.

This will append the header if not already listed, otherwise leaves it
listed in the current location. The new header string is returned.

#+begin_html
  <!-- eslint-disable no-undef -->
#+end_html

#+begin_src js
// Get header string appending "Origin" to "Accept, User-Agent"
vary.append('Accept, User-Agent', 'Origin')
#+end_src

** Examples
:PROPERTIES:
:CUSTOM_ID: examples
:END:
*** Updating the Vary header when content is based on it
:PROPERTIES:
:CUSTOM_ID: updating-the-vary-header-when-content-is-based-on-it
:END:
#+begin_src js
var http = require('http')
var vary = require('vary')

http.createServer(function onRequest (req, res) {
  // about to user-agent sniff
  vary(res, 'User-Agent')

  var ua = req.headers['user-agent'] || ''
  var isMobile = /mobi|android|touch|mini/i.test(ua)

  // serve site, depending on isMobile
  res.setHeader('Content-Type', 'text/html')
  res.end('You are (probably) ' + (isMobile ? '' : 'not ') + 'a mobile user')
})
#+end_src

** Testing
:PROPERTIES:
:CUSTOM_ID: testing
:END:
#+begin_src sh
$ npm test
#+end_src

** License
:PROPERTIES:
:CUSTOM_ID: license
:END:
[[file:LICENSE][MIT]]
