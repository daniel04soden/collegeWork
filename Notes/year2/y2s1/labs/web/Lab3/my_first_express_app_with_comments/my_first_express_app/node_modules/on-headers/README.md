# on-headers

[\[\[<https://badgen.net/npm/v/on-headers>](https://npmjs.org/package/on-headers)\]\]
[\[\[<https://badgen.net/npm/dm/on-headers>](https://npmjs.org/package/on-headers)\]\]
[\[\[<https://badgen.net/npm/node/on-headers>](https://nodejs.org/en/download)\]\]
[\[\[<https://badgen.net/travis/jshttp/on-headers/master>](https://travis-ci.org/jshttp/on-headers)\]\]
[\[\[<https://badgen.net/coveralls/c/github/jshttp/on-headers/master>](https://coveralls.io/r/jshttp/on-headers?branch=master)\]\]

Execute a listener when a response is about to write headers.

## Installation

This is a [Node.js](https://nodejs.org/en/) module available through the
[npm registry](https://www.npmjs.com/). Installation is done using the
[`npm install`{.verbatim}
command](https://docs.npmjs.com/getting-started/installing-npm-packages-locally):

``` {.bash org-language="sh"}
$ npm install on-headers
```

## API

<!-- eslint-disable no-unused-vars -->

``` {.javascript org-language="js"}
var onHeaders = require('on-headers')
```

### onHeaders(res, listener)

This will add the listener `listener`{.verbatim} to fire when headers
are emitted for `res`{.verbatim}. The listener is passed the
`response`{.verbatim} object as it\'s context (`this`{.verbatim}).
Headers are considered to be emitted only once, right before they are
sent to the client.

When this is called multiple times on the same `res`{.verbatim}, the
=listener=s are fired in the reverse order they were added.

## Examples

``` {.javascript org-language="js"}
var http = require('http')
var onHeaders = require('on-headers')

http
  .createServer(onRequest)
  .listen(3000)

function addPoweredBy () {
  // set if not set by end of request
  if (!this.getHeader('X-Powered-By')) {
    this.setHeader('X-Powered-By', 'Node.js')
  }
}

function onRequest (req, res) {
  onHeaders(res, addPoweredBy)

  res.setHeader('Content-Type', 'text/plain')
  res.end('hello!')
}
```

## Testing

``` {.bash org-language="sh"}
$ npm test
```

## License

[MIT](LICENSE)
