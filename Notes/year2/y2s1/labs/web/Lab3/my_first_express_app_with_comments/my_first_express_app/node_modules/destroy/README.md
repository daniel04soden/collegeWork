# destroy

[\[\[<https://img.shields.io/npm/v/destroy.svg?style=flat-square>](https://npmjs.org/package/destroy)\]\]
[\[\[<https://img.shields.io/github/workflow/status/stream-utils/destroy/ci/master?label=ci&style=flat-square>](https://github.com/stream-utils/destroy/actions/workflows/ci.yml)\]\]
[\[\[<https://img.shields.io/coveralls/stream-utils/destroy.svg?style=flat-square>](https://coveralls.io/r/stream-utils/destroy?branch=master)\]\]
[\[\[<http://img.shields.io/npm/l/destroy.svg?style=flat-square>](LICENSE.md)\]\]
[\[\[<http://img.shields.io/npm/dm/destroy.svg?style=flat-square>](https://npmjs.org/package/destroy)\]\]

Destroy a stream.

This module is meant to ensure a stream gets destroyed, handling
different APIs and Node.js bugs.

## API

``` {.javascript org-language="js"}
var destroy = require('destroy')
```

### destroy(stream \[, suppress\])

Destroy the given stream, and optionally suppress any future
`error`{.verbatim} events.

In most cases, this is identical to a simple
`stream.destroy()`{.verbatim} call. The rules are as follows for a given
stream:

1.  If the `stream`{.verbatim} is an instance of
    `ReadStream`{.verbatim}, then call `stream.destroy()`{.verbatim} and
    add a listener to the `open`{.verbatim} event to call
    `stream.close()`{.verbatim} if it is fired. This is for a Node.js
    bug that will leak a file descriptor if `.destroy()`{.verbatim} is
    called before `open`{.verbatim}.
2.  If the `stream`{.verbatim} is an instance of a zlib stream, then
    call `stream.destroy()`{.verbatim} and close the underlying zlib
    handle if open, otherwise call `stream.close()`{.verbatim}. This is
    for consistency across Node.js versions and a Node.js bug that will
    leak a native zlib handle.
3.  If the `stream`{.verbatim} is not an instance of
    `Stream`{.verbatim}, then nothing happens.
4.  If the `stream`{.verbatim} has a `.destroy()`{.verbatim} method,
    then call it.

The function returns the `stream`{.verbatim} passed in as the argument.

## Example

``` {.javascript org-language="js"}
var destroy = require('destroy')

var fs = require('fs')
var stream = fs.createReadStream('package.json')

// ... and later
destroy(stream)
```
