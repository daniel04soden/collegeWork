# serve-static

[\[\[<https://badgen.net/npm/v/serve-static>](https://npmjs.org/package/serve-static)\]\]
[\[\[<https://badgen.net/npm/dm/serve-static>](https://npmjs.org/package/serve-static)\]\]
[\[\[<https://badgen.net/github/checks/expressjs/serve-static/master?label=linux>](https://github.com/expressjs/serve-static/actions/workflows/ci.yml)\]\]
[\[\[<https://badgen.net/appveyor/ci/dougwilson/serve-static/master?label=windows>](https://ci.appveyor.com/project/dougwilson/serve-static)\]\]
[\[\[<https://badgen.net/coveralls/c/github/expressjs/serve-static/master>](https://coveralls.io/r/expressjs/serve-static?branch=master)\]\]

## Install

This is a [Node.js](https://nodejs.org/en/) module available through the
[npm registry](https://www.npmjs.com/). Installation is done using the
[`npm install`{.verbatim}
command](https://docs.npmjs.com/getting-started/installing-npm-packages-locally):

``` {.bash org-language="sh"}
$ npm install serve-static
```

## API

``` {.javascript org-language="js"}
var serveStatic = require('serve-static')
```

### serveStatic(root, options)

Create a new middleware function to serve files from within a given root
directory. The file to serve will be determined by combining
`req.url`{.verbatim} with the provided root directory. When a file is
not found, instead of sending a 404 response, this module will instead
call `next()`{.verbatim} to move on to the next middleware, allowing for
stacking and fall-backs.

1.  Options

    1.  acceptRanges

        Enable or disable accepting ranged requests, defaults to true.
        Disabling this will not send `Accept-Ranges`{.verbatim} and
        ignore the contents of the `Range`{.verbatim} request header.

    2.  cacheControl

        Enable or disable setting `Cache-Control`{.verbatim} response
        header, defaults to true. Disabling this will ignore the
        `immutable`{.verbatim} and `maxAge`{.verbatim} options.

    3.  dotfiles

        Set how \"dotfiles\" are treated when encountered. A dotfile is
        a file or directory that begins with a dot (\".\"). Note this
        check is done on the path itself without checking if the path
        actually exists on the disk. If `root`{.verbatim} is specified,
        only the dotfiles above the root are checked (i.e.Â the root
        itself can be within a dotfile when set to \"deny\").

        - `'allow'`{.verbatim} No special treatment for dotfiles.
        - `'deny'`{.verbatim} Deny a request for a dotfile and
          403/=next()=.
        - `'ignore'`{.verbatim} Pretend like the dotfile does not exist
          and 404/=next()=.

        The default value is similar to `'ignore'`{.verbatim}, with the
        exception that this default will not ignore the files within a
        directory that begins with a dot.

    4.  etag

        Enable or disable etag generation, defaults to true.

    5.  extensions

        Set file extension fallbacks. When set, if a file is not found,
        the given extensions will be added to the file name and search
        for. The first that exists will be served. Example:
        `['html', 'htm']`{.verbatim}.

        The default value is `false`{.verbatim}.

    6.  fallthrough

        Set the middleware to have client errors fall-through as just
        unhandled requests, otherwise forward a client error. The
        difference is that client errors like a bad request or a request
        to a non-existent file will cause this middleware to simply
        `next()`{.verbatim} to your next middleware when this value is
        `true`{.verbatim}. When this value is `false`{.verbatim}, these
        errors (even 404s), will invoke `next(err)`{.verbatim}.

        Typically `true`{.verbatim} is desired such that multiple
        physical directories can be mapped to the same web address or
        for routes to fill in non-existent files.

        The value `false`{.verbatim} can be used if this middleware is
        mounted at a path that is designed to be strictly a single file
        system directory, which allows for short-circuiting 404s for
        less overhead. This middleware will also reply to all methods.

        The default value is `true`{.verbatim}.

    7.  immutable

        Enable or disable the `immutable`{.verbatim} directive in the
        `Cache-Control`{.verbatim} response header, defaults to
        `false`{.verbatim}. If set to `true`{.verbatim}, the
        `maxAge`{.verbatim} option should also be specified to enable
        caching. The `immutable`{.verbatim} directive will prevent
        supported clients from making conditional requests during the
        life of the `maxAge`{.verbatim} option to check if the file has
        changed.

    8.  index

        By default this module will send \"index.html\" files in
        response to a request on a directory. To disable this set
        `false`{.verbatim} or to supply a new index pass a string or an
        array in preferred order.

    9.  lastModified

        Enable or disable `Last-Modified`{.verbatim} header, defaults to
        true. Uses the file system\'s last modified value.

    10. maxAge

        Provide a max-age in milliseconds for http caching, defaults
        to 0. This can also be a string accepted by the
        [ms](https://www.npmjs.org/package/ms#readme) module.

    11. redirect

        Redirect to trailing \"/\" when the pathname is a dir. Defaults
        to `true`{.verbatim}.

    12. setHeaders

        Function to set custom headers on response. Alterations to the
        headers need to occur synchronously. The function is called as
        `fn(res, path, stat)`{.verbatim}, where the arguments are:

        - `res`{.verbatim} the response object
        - `path`{.verbatim} the file path that is being sent
        - `stat`{.verbatim} the stat object of the file that is being
          sent

## Examples

### Serve files with vanilla node.js http server

``` {.javascript org-language="js"}
var finalhandler = require('finalhandler')
var http = require('http')
var serveStatic = require('serve-static')

// Serve up public/ftp folder
var serve = serveStatic('public/ftp', { index: ['index.html', 'index.htm'] })

// Create server
var server = http.createServer(function onRequest (req, res) {
  serve(req, res, finalhandler(req, res))
})

// Listen
server.listen(3000)
```

### Serve all files as downloads

``` {.javascript org-language="js"}
var contentDisposition = require('content-disposition')
var finalhandler = require('finalhandler')
var http = require('http')
var serveStatic = require('serve-static')

// Serve up public/ftp folder
var serve = serveStatic('public/ftp', {
  index: false,
  setHeaders: setHeaders
})

// Set header to force download
function setHeaders (res, path) {
  res.setHeader('Content-Disposition', contentDisposition(path))
}

// Create server
var server = http.createServer(function onRequest (req, res) {
  serve(req, res, finalhandler(req, res))
})

// Listen
server.listen(3000)
```

### Serving using express

1.  Simple

    This is a simple example of using Express.

    ``` {.javascript org-language="js"}
    var express = require('express')
    var serveStatic = require('serve-static')

    var app = express()

    app.use(serveStatic('public/ftp', { index: ['default.html', 'default.htm'] }))
    app.listen(3000)
    ```

2.  Multiple roots

    This example shows a simple way to search through multiple
    directories. Files are searched for in
    `public-optimized/`{.verbatim} first, then `public/`{.verbatim}
    second as a fallback.

    ``` {.javascript org-language="js"}
    var express = require('express')
    var path = require('path')
    var serveStatic = require('serve-static')

    var app = express()

    app.use(serveStatic(path.join(__dirname, 'public-optimized')))
    app.use(serveStatic(path.join(__dirname, 'public')))
    app.listen(3000)
    ```

3.  Different settings for paths

    This example shows how to set a different max age depending on the
    served file type. In this example, HTML files are not cached, while
    everything else is for 1 day.

    ``` {.javascript org-language="js"}
    var express = require('express')
    var path = require('path')
    var serveStatic = require('serve-static')

    var app = express()

    app.use(serveStatic(path.join(__dirname, 'public'), {
      maxAge: '1d',
      setHeaders: setCustomCacheControl
    }))

    app.listen(3000)

    function setCustomCacheControl (res, path) {
      if (serveStatic.mime.lookup(path) === 'text/html') {
        // Custom Cache-Control for HTML files
        res.setHeader('Cache-Control', 'public, max-age=0')
      }
    }
    ```

## License

[MIT](LICENSE)
