//I ended up redoing the majority of this file in the try catch format as createIndex didn't work with the original res!=1 check
//Since I was redoing a majority of the code anyway I decided to opt for more try catches in case there was another instance of res!=1 not working with a funciton
//----------------------------------------------------
//
//  7. Shard the collection
//
//----------------------------------------------------

//------------------------------------------------
// 7.1. Variables
//------------------------------------------------
db = db.getSiblingDB("diabetesAnalysisDB");
var res = null;

//------------------------------------------------
// 7.2. Set custom chunk size
//------------------------------------------------
try {
  db.getSiblingDB("config").settings.updateOne(
    {_id:"chunksize"},
    {$set:{_id:"chunksize", value: 4 }},
    {upsert:true}
  );
  print("Chunk size set to 4MB.");
} catch (e){
  print("Failed to set chunk size: "+e.message);
}

//------------------------------------------------
// 7.3. Enable sharding for the database
//------------------------------------------------

//------------------------------------------------
// 7.4. Wait for data to be imported (if needed)
//------------------------------------------------
while (db.healthIndicators.countDocuments() === 0) {
  print("Waiting for data import");
  sleep(5000);
}
print("Data imported");


//------------------------------------------------
// 7.7. Show sharding status
//------------------------------------------------
print("Printing sharding status...");
print(sh.status);

//------------------------------------------------
// 7.8. Quit
//------------------------------------------------
quit();

